{% extends 'layout.html' %}

{% load static %}

{% block style %}
	<style>
		.main{
			min-height: calc(100vh - 54px);   /* So that footer is at the bottom (without scroll) if screen is short*/
		}

		.sidebar {
			position: fixed;
			top: 71.4px;
			bottom: 54px;
			left: 0;
			/* z-index: 100;  */
			/* Behind the navbar */
			/* padding: 28px 0 0; */
			 /* Height of navbar */
			box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
			overflow-y: auto;
		}

		/* .sidebar-sticky { */
			/* position: relative; */
			/* top: 0; */
			/* height: calc(100vh - 48px); */
			/* padding-top: .5rem; */
			/* overflow-x: hidden; */
			/* overflow-y: auto;  */
			/* Scrollable contents if viewport is shorter than content. */
		/* } */

		/* @supports ((position: -webkit-sticky) or (position: sticky)) {
			.sidebar-sticky {
				position: -webkit-sticky;
				position: sticky;
			}
		} */

		/* .sidebar .nav-link {
			font-weight: 500;
			color: #333;
		} */

		/* .sidebar .nav-link.active {
			color: #007bff;
		} */

		.sidebar-heading {
			font-size: .75rem;
			text-transform: uppercase;
		}

		.dash-img{
			width: 100px;
			height: 100px;
		}
		.dash-list li{
			margin: 5px 0;
		}


		@media(max-width: 767px){
			.sidebar{
				position:static;
			}
			.main{
				min-height: 100vh;
			}
		}

	</style>

{% endblock %}

{% block content %}

	<div class="container-fluid">
		<div class="row justify-content-end">
			<nav class="col-md-4 col-lg-3 d-md-block bg-light sidebar">
				<div class="sidebar-sticky">
					<ul class="dash-list nav flex-column text-center">
						<li class="nav-item">
							<img class="dash-img rounded-circle my-3" src='{% static "logo.png" %}' alt="v">
						</li>

						{% if volunteer is not None %}
							<li class="nav-item">
								<h5>Name: <span class="lead"> {{volunteer.first_name}} {{volunteer.last_name}}</span> </h5>
							</li>
							<li class="nav-item">
								<h5>Roll No: <span class="lead">{{volunteer.roll_no}}</span> </h5>
							</li>
						{% endif %}

						<li class="nav-item">
							<h5>Email: <span class="lead">{{user.email}}</span> </h5>
						</li>
						<li class="nav-item">
							<h5 class="mt-3">Schedule</h5>
						</li>
						{% if vol_schedule is not None %}
							<li class="nav-item">
								<h5>Day: <span class="lead"> {{vol_schedule.day}}</span> </h5>
							</li>
							<li class="nav-item">
								<h5>Section: <span class="lead">{{vol_schedule.schedule.get_section_display}}</span> </h5>
							</li>
							<li class="nav-item">
								<h5>Subject: <span class="lead">{{vol_schedule.schedule.get_subject_display}}</span> </h5>
							</li>
						{% else %}
							<li class="nav-item">
								<h5>Day: <span class="lead"> -- </span> </h5>
							</li>
							<li class="nav-item">
								<h5>Section: <span class="lead"> -- </span> </h5>
							</li>
							<li class="nav-item">
								<h5>Subject: <span class="lead"> -- </span> </h5>
							</li>
						{% endif %}
						<li class="nav-item">
							<button type="button" class="btn btn-outline-primary mt-3"> Update Schedule</button>
						</li>
						<li class="nav-item">
							<button type="button" class="btn btn-outline-primary" onclick="show_dash_update()" > Update Profile</button>
						</li>
						
						
					</ul>
				</div>
			</nav>

			<div class="dash-main col-md-8 col-lg-9 mt-3">
				<h3 class="text-center">Welcome {{volunteer.first_name}} {{volunteer.last_name}}!</h3>
				<form method="POST">
					{% csrf_token %}
					<div class="row justify-content-center">
						<div class="col-md-4 mb-3">
							<label for="class-date">Date</label>
							<!-- <input type="text" class="form-control" id="firstName" placeholder="" value="" required> -->
							<input name="class-info-date" data-date-format="yyyy-mm-dd" id="class-date" class="form-control" required>
						</div>
						<div class="col-md-4 mb-3">
							<label for="class-section">Section</label>
							<select name="class-info-section" class="custom-select d-block w-100" id="class-section" required>
								{% for sec, display in choices %}
									{% if sec == selected_schedule %}
									<option value="{{sec}}" selected>{{display}}</option>
									{% else %}
									<option value="{{sec}}">{{display}}</option>
									{% endif %}
								{% endfor %}
							</select>
						</div>
					</div>
					<div class="row justify-content-center mb-4">
						<div class="col-md-4">
							<button name="submit" value="class-info" class="btn btn-primary btn-lg btn-block" type="submit">Continue</button>
						</div>
					</div>
				</form>

				{% if not submitted %}
					{% if no_class_found %}
					<p class="text-center mt-4">The chosen day is not yet updated in the Calendar.</p>
					{% elif no_class_scheduled %}
					<p class="text-center mt-4">No class was scheduled on the chosen day.</p>
					<p class="text-center">{{calendar.remark}}</p>
					{% elif no_schedule_found %}
					<p class="text-center mt-4">The chosen section is not taught on the chosen date.</p>
					{% else %}
					<div class="row justify-content-center mt-4">
						<div class="col-md-5 col-lg-4 border rounded">
							<h4 class="text-center mt-2">ClassWork</h4>
							<hr>
							<p><pre>{{cw_hw.cw}}</pre></p>
						</div>
						<div class="col-md-1"></div>
						<div class="col-md-5 col-lg-4 border rounded">
							<h4 class="text-center mt-2">HomeWork</h4>
							<hr>
							<p><pre>{{cw_hw.hw}}</pre></p>
						</div>
					</div>
					<div class="row justify-content-center mt-4">
						<div class="col-md-8 border rounded">
							<h4 class="text-center mt-3">Students Present</h4>
							<hr>
							<p>
								{% if students_attended.count %}
									{% for stu_att in students_attended %}
										<span class="text-monospace font-weight-lighter">{{stu_att.sid.first_name}} {{stu_att.sid.last_name}}</span>
										<br>
									{% endfor %}
								{% else %}
									<pre>{{students_attended}}</pre>
								{% endif %}
							</p>
						</div>
					</div>
					{% endif %}
				{% endif %}
			</div>
			<div class="dash-update d-none col-md-8 col-lg-9 mt-3">
				<h3 class="text-center">Update Profile</h3>
				<div class="row justify-content-center">
					<div class="col-lg-8">
						<form method="POST">
							{% csrf_token %}
							<div class="row">
								<div class="col-md-6 mb-3">
									<label for="rollNo">Roll No.</label>
									<input name="roll_no" type="number" class="form-control" id="rollNo" placeholder="{{volunteer.roll_no}}" value="">
								</div>
							</div>
			
							<div class="row">
								<div class="col-md-6 mb-3">
									<label for="firstName">First name</label>
									<input name="first_name" type="text" class="form-control" id="firstName" placeholder="{{volunteer.first_name}}" value="">
								</div>
								<div class="col-md-6 mb-3">
									<label for="lastName">Last name</label>
									<input name="last_name" type="text" class="form-control" id="lastName" placeholder="{{volunteer.last_name}}" value="">
								</div>
							</div>
			
							<div class="row">
								<div class="col-md-4 mb-3">
									<label for="gender">Gender</label>
									<select name="gender" class="custom-select d-block w-100" id="gender">
										<option value="M" {% if volunteer.gender == "M" %} selected {% endif %} >Male</option>
										<option value="F" {% if volunteer.gender == "F" %} selected {% endif %} >Female</option>
										<option value="O" {% if volunteer.gender == "O" %} selected {% endif %} >Other</option>
									</select>
								</div>
								<div class="col-md-4 mb-3">
									<label for="batch">Batch</label>
									<select name="batch" class="custom-select d-block w-100" id="batch">
										{% for i in '43210'|make_list %}
											{% if volunteer.batch == last_4_year|add:i %}
											<option value="{{last_4_year|add:i}}" selected>{{last_4_year|add:i}}</option>
											{% else %}
											<option value="{{last_4_year|add:i}}">{{last_4_year|add:i}}</option>
											{% endif %}
										{% endfor %}
									</select>
								</div>
								<div class="col-md-4 mb-3">
									<label for="programme">Programme</label>
									<select name="programme" class="custom-select d-block w-100" id="programme">
										<option value="bt" {% if volunteer.programme == "bt" %} selected {% endif %} >B.Tech</option>
										<option value="mt" {% if volunteer.programme == "mt" %} selected {% endif %} >M.Tech</option>
										<option value="phd" {% if volunteer.programme == "phd" %} selected {% endif %} >phD</option>
										<option value="bd" {% if volunteer.programme == "bd" %} selected {% endif %} >B.Des</option>
										<option value="md" {% if volunteer.programme == "md" %} selected {% endif %} >M.Des</option>
									</select>
								</div>
							</div>
			
							<div class="row">
								<div class="col-md-4 mb-3">
									<label for="dob">Date of Birth</label>
									<input name="dob" data-date-format="yyyy-mm-dd" id="dob" class="form-control">
								</div>
								<div class="col-md-8 mb-3">
									<label for="contactNo">Contact No.</label>
									<input name="contact_no" type="number" class="form-control" id="contactNo" placeholder="{{volunteer.contact_no}}" value="">
								</div>
							</div>
						
							<div class="mb-3">
								<label for="altemail">Alternate Email <span class="text-muted">(Optional)</span></label>
								<input name="alt_email" type="email" class="form-control" id="altemail" placeholder="{{volunteer.alt_email}}">
							</div>
						
							<div class="mb-3">
								<label for="address">Address</label>
								<input name="street_address1" type="text" class="form-control" id="address" placeholder="{{volunteer.street_address1}}">
							</div>
						
							<div class="mb-3">
								<label for="address2">Address 2 <span class="text-muted">(Optional)</span></label>
								<input name="street_address2" type="text" class="form-control" id="address2" placeholder="{{volunteer.street_address2}}">
							</div>
						
							<div class="row">
								<div class="col-md-5 mb-3">
								<label for="city">City</label>
								<input name="city" type="text" class="form-control" id="city" placeholder="{{volunteer.city}}" value="">
								</div>
								<div class="col-md-4 mb-3">
								<label for="state">State</label>
								<input name="state" type="text" class="form-control" id="state" placeholder="{{volunteer.state}}" value="">
								</div>
								<div class="col-md-3 mb-3">
								<label for="pinCode">PIN Code</label>
								<input name="pincode" type="number" class="form-control" id="pinCode" placeholder="{{volunteer.pincode}}">
								</div>
							</div>
							<hr class="mb-4">
							<div class="row justify-content-center mb-4">
								<div class="col-md-6">
									<button name="submit" value="update-profile" class="btn btn-primary btn-lg btn-block" type="submit">Update</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>

			<input type="hidden" id="extra-info-1" value="{{ selected_date|date:'Y-m-d' }}">
			<div class="col-md-8 col-lg-9" style="height: 54px;"></div>
			

		</div>
	</div>

{% endblock %}

{% block scripts %}
<style>
	footer{
		position: fixed;
		bottom: 0;
		width: 100vw;
	}
	@media(max-width: 767px){
		footer{
			position: static;
		}
	}
</style>


<script type="text/javascript">
	(function () {
		'use strict'
		window.addEventListener('load', function () {
			// Fetch all the forms we want to apply custom Bootstrap validation styles to
			var forms = document.getElementsByClassName('needs-validation')

			// Loop over them and prevent submission
			Array.prototype.filter.call(forms, function (form) {
				form.addEventListener('submit', function (event) {
				if (form.checkValidity() === false) {
					event.preventDefault()
					event.stopPropagation()
				}
				form.classList.add('was-validated')
				}, false)
			})
		}, false)
	}())
</script>

<!-- Script for Main Dashboard Date Picker -->
<script type="text/javascript">
	$('#class-date').datepicker({
		weekStart: 1,
		autoclose: true,
		todayHighlight: true,
	});
	if(document.getElementById("extra-info-1").value.length>0)
		$('#class-date').datepicker("setDate", "{{ selected_date|date:'Y-m-d' }}");
	else
		$('#class-date').datepicker("setDate", new Date());
	
</script>

<!-- Script for Date Pickers -->
<script type="text/javascript">
	$('#dob').datepicker({
		weekStart: 1,
		autoclose: true,
		todayHighlight: true,
	});
	$('#dob').datepicker("setDate", "{{ volunteer.dob|date:'Y-m-d' }}");
</script>


<!-- Script for sidebar buttons -->
<script>
	let dash_main = document.querySelector(".dash-main");
	let dash_update = document.querySelector(".dash-update");
	function show_dash_update(){
		dash_main.classList.add("d-none");
		dash_update.classList.remove("d-none");
	}

</script>
{% endblock %}